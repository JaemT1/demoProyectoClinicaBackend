<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossorigin="anonymous">
    <meta charset="UTF-8">
    <title>Registro Usuario</title>
</head>
<body>

<div style="position:absolute;
top: 40%;
left: 26%;
height:400px;
width:600px;
margin-top:-240px;
">

    <div class="d-grid gap-2 d-md-block mb-3" style="text-align: left;margin: auto; width: 400px;">
        <h1>Registro</h1>
        <form style="text-align: center;border: 2px solid rgba(0,0,0,0.06);border-radius: 10px; padding: 20px;" th:action="@{/registroPaciente}" method="post" th:object="${data}">

            <input type="text" placeholder="Nombre Completo" name="nombreCompleto" id="nombreCompleto" required
                   class="form-control" th:field="*{usuario.nombre}"/>

            <input style="margin-top: 30px" type="text" placeholder="Numero de Identificación" name="cedula" id="cedula"
                   required
                   class="form-control" th:field="*{usuario.cedula}" maxlength="10"/>

            <input style="margin-top: 30px" type="text" placeholder="Teléfono" name="telefono" id="telefono" required
                   class="form-control" th:field="*{usuario.telefono}"/>

            <div style="margin-top: 30px">
                <select class="form-select" aria-label="Departamento" id="departamento" name="departamento">
                    <option disabled selected>Selecciona el departamento</option>
                </select>
            </div>

            <div style="margin-top: 30px">
                <select class="form-select" aria-label="Ciudad" id="ciudad" name="ciudad">
                    <option disabled selected >Selecciona una ciudad</option>
                </select>
            </div>

            <input style="margin-top: 30px" type="email" placeholder="Email" name="email" id="email" required
                   class="form-control" th:field="*{usuario.email}"/>

            <input style="margin-top: 30px" type="password" placeholder="Contraseña" name="Contrasena" id="contrasena"
                   required
                   class="form-control" th:field="*{usuario.contrasena}"/>


            <div style="margin-top: 30px" class="mb-3">
                <label for="fotoFile" class="form-label">Seleccione una foto</label>
                <input class="form-control form-control-sm" id="fotoFile" type="file" accept=".jpg, .jpeg, .png">
            </div>


            <div class="mb-3">
                <label for="fecha_nacimiento">Fecha de nacimiento</label>
                <input type="date" class="form-control" id="fecha_nacimiento" name="fecha_nacimiento" required th:field="*{paciente.fechaNacimiento}">
            </div>
            <div class="mb-3">
                <input type="text" placeholder="Alergias" class="form-control" id="alergias" name="alergias" required th:field="*{paciente.alergias}">
            </div>

            <div class="mb-3">
                <select class="form-select" aria-label="Eps" id="eps" name="eps">
                    <option disabled selected >Selecciona una eps</option>
                    <option>SURA</option>
                </select>
            </div>
            <div class="mb-3">
                <select class="form-select" id="tipo_sangre" name="tipo_sangre">
                    <option disabled selected>Tipo de sangre</option>
                    <option value="A+">A+</option>
                    <option value="A-">A-</option>
                    <option value="B+">B+</option>
                    <option value="B-">B-</option>
                    <option value="O+">O+</option>
                    <option value="O-">O-</option>
                    <option value="AB+">AB+</option>
                    <option value="AB-">AB-</option>
                </select>
            </div>

            <div style="margin-top: 30px;">
                <input style="border-radius: 20px;" class="btn btn-primary" type="submit" name="registro" id="registro"
                       value="Registrarse" onclick=""/>
            </div>
        </form>
    </div>
</div>

<script>

// Función para cargar los estados de Colombia
function cargarEstados(auth_token) {
fetch("https://www.universal-tutorial.com/api/states/colombia", {
method: "GET",
headers: {
"Authorization": `Bearer ${auth_token}`,
"Accept": "application/json"
}
})
.then(response => response.json())
.then(data => {
const departamentoSelect = document.getElementById("departamento");

// Llena el select de departamentos
for (let i = 0; i < data.length; i++) {
const option = document.createElement("option");
option.text = data[i].state_name;
departamentoSelect.add(option);
}

// Habilita el select de departamentos
departamentoSelect.disabled = false;
})
.catch(error => {
console.error("Error al obtener datos de departamentos:", error);
});
}

// Función para cargar las ciudades de un estado seleccionado
function cargarCiudades(auth_token, estado) {
fetch(`https://www.universal-tutorial.com/api/cities/${estado}`, {
method: "GET",
headers: {
"Authorization": `Bearer ${auth_token}`,
"Accept": "application/json"
}
})
.then(response => response.json())
.then(data => {
const ciudadSelect = document.getElementById("ciudad");

// Llena el select de ciudades
ciudadSelect.innerHTML = "";
for (let i = 0; i < data.length; i++) {
const option = document.createElement("option");
option.text = data[i].city_name;
ciudadSelect.add(option);
}

// Habilita el select de ciudades
ciudadSelect.disabled = false;
})
.catch(error => {
console.error("Error al obtener datos de ciudades:", error);
});
}

// Obtener el token de autenticación
fetch("https://www.universal-tutorial.com/api/getaccesstoken", {
method: "GET",
headers: {
"Accept": "application/json",
"api-token": "2XA6kP5Jis8AyQij3yf9lpe_dDT89bQp27Necv_XxUwlc5D8tdoMuW-75YSdmxUTQZ4",
"user-email": "smoralesd@uqvirtual.edu.co"
}
})
.then(response => response.json())
.then(data => {
const auth_token = data.auth_token;

// Llamar a la función para cargar los estados de Colombia
cargarEstados(auth_token);

// Evento para cargar las ciudades cuando se selecciona un estado
const departamentoSelect = document.getElementById("departamento");
departamentoSelect.addEventListener("change", function () {
const selectedDepartamento = departamentoSelect.value;
cargarCiudades(auth_token, selectedDepartamento);
});
})
.catch(error => {
console.error("Error al obtener el token de autenticación:", error);
});

</script>
</body>
</html>
